const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MarkdownEditor-CKHqtHLe.js","assets/index-Ok4mnEmM.js","assets/index-CHPbMJZM.css","assets/index-BfzsJM49.js","assets/isAddressEqual-gZzG8_o9.js","assets/secp256k1-DJUQ9hgm.js","assets/useQuery-DcmfAyTL.js","assets/useAccount-DjdkbNyF.js","assets/index-BDYr2gml.js","assets/index-DgVYSesK.js","assets/index-C2TjqpFy.js","assets/tslib.es6-B2dMZmZB.js","assets/index-CK2yHQ_N.js"])))=>i.map(i=>d[i]);
var U=Object.defineProperty;var z=(e,n,a)=>n in e?U(e,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[n]=a;var I=(e,n,a)=>z(e,typeof n!="symbol"?n+"":n,a);import{Q as W,r as y,N as K,j as t,f as v,b as Y,R,_ as j,T as H,B as V,D as G,m as J,h as X,a as Z}from"./index-Ok4mnEmM.js";import{u as S,M as ee}from"./index-BEDwgujn.js";import{g as A,r as E}from"./gql-DHmsBT2a.js";import{p as te}from"./playbooks-CE06kfJh.js";import{a as Q,u as ne}from"./useAccount-DjdkbNyF.js";import{f as se,u as $,a as ae,T as ie,b as re,d as oe,e as le,g as ue,w as ce,c as pe}from"./index-BfzsJM49.js";import{u as B}from"./markdown-editor-BlURDHlG.js";import"./useQuery-DcmfAyTL.js";import"./isAddressEqual-gZzG8_o9.js";import"./secp256k1-DJUQ9hgm.js";import"./index-BDYr2gml.js";import"./index-DgVYSesK.js";function de(e,n={}){return{async queryFn({queryKey:a}){const{hash:s,...c}=a[1];if(!s)throw new Error("hash is required");return W(e,{...c,onReplaced:n.onReplaced,hash:s})},queryKey:ye(n)}}function ye(e={}){const{onReplaced:n,...a}=e;return["waitForTransactionReceipt",se(a)]}function P(e={}){const{hash:n,query:a={}}=e,s=Q(e),c=$({config:s}),r=de(s,{...e,chainId:e.chainId??c}),p=!!(n&&(a.enabled??!0));return ae({...a,...r,enabled:p})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,n){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,n),n)}};const me=A`
  query ChainDetails($name: String!, $reader: String) {
    questChains(
      where: {
        name_starts_with_nocase: $name,
        name_ends_with_nocase: $name
      }
    ) {
      id
      address
      description
      imageUrl
      token {
        tokenId
        imageUrl
        tokenAddress
        owners(where: { id: $reader }) {
          id
        }
      }
      createdBy {
        id
      }
      updatedAt
      quests(orderBy: questId) {
        questId
        name
        description
        optional
        status { status }
      }
    }
  }
`,he=A`
  query ChainDetails($chain: String!, $user: String!) {
    questStatuses(where: {
      questChain: $chain, user: $user
    }, orderBy: quest__questId) {
      status
      quest {
        questId
        paused
      }
      submissions {
        name
        description
        details
        externalUrl
      }
    }
  }
`;class fe extends Array{constructor(...a){super();I(this,"current",0);this.push(...a)}get active(){return this[this.current]}}const F=y.createContext(null),D=()=>y.useContext(F),M=()=>{const e=D();if(!e)throw new Error("No book.");if(e.status==="error")throw e.error;if(e.status==="init")throw new Error(`Loading Book: "${e.title}".`);return e},be=({slug:e,children:n,chapter:a=0})=>{var k;const[s,c]=y.useState(a),{title:r}=te.map(({books:f})=>f).flat().find(({title:f})=>K(f)===e)??{};if(!r)throw new Error(`Book "${e}" not found.`);const p=ne(),u=((k=p==null?void 0:p.address)==null?void 0:k.toLowerCase())??null,{data:{questChains:[i]=[]}={},error:w,isLoading:T}=S({queryKey:[`chain-${e}`],queryFn:async()=>E("https://api.studio.thegraph.com/query/71457/quest-chains-optimism/version/latest",me,{name:r,reader:u})}),{data:h,error:l}=S({queryKey:[`statuses-${i==null?void 0:i.id}-${u}`],queryFn:async()=>!u||!(i!=null&&i.id)?null:E("https://api.studio.thegraph.com/query/71457/quest-chains-optimism/version/latest",he,{chain:i.id,user:u})}),{questStatuses:d}=h??{};let x=null;const N=w??l;if(N)x={status:"error",error:N};else if(T)x={status:"init",slug:e,title:r};else{const f=new fe({optional:!0,title:"Introduction",content:i.description,status:"init"},...i.quests.map((g,o)=>{const m=d==null?void 0:d.find(({quest:{questId:b}})=>Number(b)===o);return{optional:g.optional,title:g.name,content:g.description,status:(m==null?void 0:m.status)??null}}));f.current=s;const C={slug:e,title:r,introduction:i.description,chapters:f,creator:i.createdBy.id,owners:[],updatedAt:new Date(Number(i.updatedAt)*1e3),contract:i.id,nft:{id:Number(i.token.tokenId),address:i.token.tokenAddress,image:i.token.imageUrl,minted:i.token.owners.length>0},on:s,setOn:c};u===null?x={status:"load",...C,reader:u}:x={status:"auth",...C,reader:u}}return t.jsx(F.Provider,{value:x,children:n})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,n){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,n),n)}};function xe(){const e=M();return t.jsx("ol",{id:"chapters",className:"flex flex-col max-w-72 text-balance mt-4 mr-4 sticky top-0 z-50",children:e.chapters.map((n,a)=>{const{status:s}=n;let c=s==null?"You have not yet submitted a proof for this chapter.":`Your submission ${(()=>{switch(s){case"pass":return"has been approved.";case"fail":return"has been rejected.";case"review":return"is under review.";default:return`has a \`state\` of "${s}".`}})()}`,r=(()=>{switch(s){case"pass":return"fill-green-500";case"fail":return"fill-red-500";case"review":return"fill-orange-400";case"init":return"fill-secondary";case null:case void 0:return"fill-blue-400";default:return console.warn(`Unknown \`state\`: "${s}".`),"fill-blue-600"}})();return a===0&&(c="No submission required for this chapter.",r="fill-yellow-500"),t.jsx(ie,{children:t.jsxs(re,{children:[t.jsx(oe,{children:t.jsx("li",{onClick:()=>{var p;return(p=e.setOn)==null?void 0:p.call(e,a)},className:v("card shadow-md p-3 hover:bg-yellow-300/75 hover:text-black"),children:t.jsxs(Y,{to:`../${a}`,className:"flex",children:[t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 50 50",className:"w-8 h-8 flex-shrink-0 mr-2 self-center",children:[t.jsx("circle",{cx:"50%",cy:"50%",r:"40%",className:r,stroke:v(n.optional?"#A44F":"#000B"),strokeWidth:8,strokeDasharray:v(n.optional&&"5 15"),strokeLinecap:"round",paintOrder:"stroke fill"}),t.jsx("text",{x:"50%",y:"57%",fontSize:"2.5rem",textAnchor:"middle",dominantBaseline:"middle",className:"fill-black font-bold",children:a+1})]}),t.jsx("h2",{className:"text-lg font-medium text-left",children:n.title})]})},a)}),t.jsxs(le,{side:"right",className:v("card shadow-md p-3 hover:bg-yellow-300/75 hover:text-black",s==="pass"&&"bg-success",s==="fail"&&"bg-error",s==="review"&&"bg-info",s==="init"&&"bg-secondary text-white",s==null&&"bg-primary"),children:[c,t.jsx(ue,{width:11,height:5,className:v("",s==="pass"&&"fill-success",s==="fail"&&"fill-error",s==="review"&&"fill-info",s==="init"&&"fill-secondary text-white",s==null&&"fill-primary")})]})]})},a)})})}const O=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"editor",type:"address"},{indexed:!1,internalType:"uint256[]",name:"questIdList",type:"uint256[]"},{components:[{internalType:"bool",name:"paused",type:"bool"},{internalType:"bool",name:"optional",type:"bool"},{internalType:"bool",name:"skipReview",type:"bool"}],indexed:!1,internalType:"struct IQuestChain.QuestDetails[]",name:"questDetails",type:"tuple[]"}],name:"ConfiguredQuests",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint8",name:"version",type:"uint8"}],name:"Initialized",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"account",type:"address"}],name:"Paused",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"editor",type:"address"},{indexed:!1,internalType:"string",name:"details",type:"string"}],name:"QuestChainEdited",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"string",name:"details",type:"string"},{indexed:!1,internalType:"string[]",name:"quests",type:"string[]"},{indexed:!1,internalType:"bool",name:"paused",type:"bool"}],name:"QuestChainInit",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"string",name:"tokenURI",type:"string"}],name:"QuestChainTokenURIUpdated",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"reviewer",type:"address"},{indexed:!1,internalType:"address[]",name:"questerList",type:"address[]"},{indexed:!1,internalType:"uint256[]",name:"questIdList",type:"uint256[]"},{indexed:!1,internalType:"bool[]",name:"successList",type:"bool[]"},{indexed:!1,internalType:"string[]",name:"detailsList",type:"string[]"}],name:"QuestProofsReviewed",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"quester",type:"address"},{indexed:!1,internalType:"uint256[]",name:"questIdList",type:"uint256[]"},{indexed:!1,internalType:"string[]",name:"proofList",type:"string[]"}],name:"QuestProofsSubmitted",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"creator",type:"address"},{indexed:!1,internalType:"string[]",name:"detailsList",type:"string[]"}],name:"QuestsCreated",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"editor",type:"address"},{indexed:!1,internalType:"uint256[]",name:"questIdList",type:"uint256[]"},{indexed:!1,internalType:"string[]",name:"detailsList",type:"string[]"}],name:"QuestsEdited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"role",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"previousAdminRole",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"newAdminRole",type:"bytes32"}],name:"RoleAdminChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"role",type:"bytes32"},{indexed:!0,internalType:"address",name:"account",type:"address"},{indexed:!0,internalType:"address",name:"sender",type:"address"}],name:"RoleGranted",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"role",type:"bytes32"},{indexed:!0,internalType:"address",name:"account",type:"address"},{indexed:!0,internalType:"address",name:"sender",type:"address"}],name:"RoleRevoked",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"limiterContract",type:"address"}],name:"SetLimiter",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"account",type:"address"}],name:"Unpaused",type:"event"},{inputs:[],name:"ADMIN_ROLE",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"DEFAULT_ADMIN_ROLE",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"EDITOR_ROLE",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"REVIEWER_ROLE",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"burnToken",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256[]",name:"_questIdList",type:"uint256[]"},{components:[{internalType:"bool",name:"paused",type:"bool"},{internalType:"bool",name:"optional",type:"bool"},{internalType:"bool",name:"skipReview",type:"bool"}],internalType:"struct IQuestChain.QuestDetails[]",name:"_questDetails",type:"tuple[]"}],name:"configureQuests",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"string[]",name:"_detailsList",type:"string[]"}],name:"createQuests",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"string",name:"_details",type:"string"}],name:"edit",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256[]",name:"_questIdList",type:"uint256[]"},{internalType:"string[]",name:"_detailsList",type:"string[]"}],name:"editQuests",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"}],name:"getRoleAdmin",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"getTokenURI",outputs:[{internalType:"string",name:"uri",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"_role",type:"bytes32"},{internalType:"address",name:"_account",type:"address"}],name:"grantRole",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"},{internalType:"address",name:"account",type:"address"}],name:"hasRole",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"address[]",name:"owners",type:"address[]"},{internalType:"address[]",name:"admins",type:"address[]"},{internalType:"address[]",name:"editors",type:"address[]"},{internalType:"address[]",name:"reviewers",type:"address[]"},{internalType:"string[]",name:"quests",type:"string[]"},{internalType:"bool",name:"paused",type:"bool"},{internalType:"string",name:"details",type:"string"},{internalType:"string",name:"tokenURI",type:"string"}],internalType:"struct QuestChainCommons.QuestChainInfo",name:"_info",type:"tuple"}],name:"init",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"limiterContract",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"mintToken",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"pause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"paused",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"premium",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"questChainFactory",outputs:[{internalType:"contract IQuestChainFactory",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"questChainId",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"questChainToken",outputs:[{internalType:"contract IQuestChainToken",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"questCount",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"questDetails",outputs:[{internalType:"bool",name:"paused",type:"bool"},{internalType:"bool",name:"optional",type:"bool"},{internalType:"bool",name:"skipReview",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_quester",type:"address"},{internalType:"uint256",name:"_questId",type:"uint256"}],name:"questStatus",outputs:[{internalType:"enum IQuestChain.Status",name:"status",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"},{internalType:"address",name:"account",type:"address"}],name:"renounceRole",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address[]",name:"_questerList",type:"address[]"},{internalType:"uint256[]",name:"_questIdList",type:"uint256[]"},{internalType:"bool[]",name:"_successList",type:"bool[]"},{internalType:"string[]",name:"_detailsList",type:"string[]"}],name:"reviewProofs",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"_role",type:"bytes32"},{internalType:"address",name:"_account",type:"address"}],name:"revokeRole",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_limiterContract",type:"address"}],name:"setLimiter",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"string",name:"_tokenURI",type:"string"}],name:"setTokenURI",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256[]",name:"_questIdList",type:"uint256[]"},{internalType:"string[]",name:"_proofList",type:"string[]"}],name:"submitProofs",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"interfaceId",type:"bytes4"}],name:"supportsInterface",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"unpause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"upgrade",outputs:[],stateMutability:"nonpayable",type:"function"}];globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,n){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,n),n)}};const L=10,ge=({children:e})=>t.jsxs("div",{role:"alert",className:"alert alert-warning flex items-center mt-10",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 shrink-0 stroke-current",fill:"none",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e]}),we=()=>{const e=M(),n=$(),a=R.useRef(null),[s,c]=y.useState(!1),[r,p]=y.useState({}),u=({type:o,error:m})=>{p(b=>({...b,[o]:m}))},{data:i,writeContract:w,isPending:T}=B(),h=Q(),l={chain:{type:"chain",error:t.jsxs("h3",{className:"flex text-center items-center justify-center",children:["Please",t.jsx("a",{onClick:()=>{var o;((o=window.ethereum)==null?void 0:o.request).call(o,{method:"wallet_switchEthereumChain",params:[{chainId:`0x${L.toString(16)}`}]})},className:"underline text-accent hover:text-accent-content mx-1",children:"switch to the Optimism network"}),"to continue."]})},account:{type:"account",error:t.jsxs("h3",{className:"flex text-center items-center justify-center",children:["Please",t.jsx("div",{className:"mx-2",children:t.jsx("w3m-button",{size:"sm"})}),"to submit a proof."]})}};y.useEffect(()=>{if(h)return ce(h,{onChange(o){o!==L&&!r.chain&&u(l.chain)}})},[h]);const{contract:d=null}=e&&"contract"in e?e:{};y.useEffect(()=>{i&&j.success(t.jsxs("p",{children:["Successfully submitted transaction",t.jsxs("a",{href:`https://optimistic.etherscan.io/tx/${i}`,className:"mx-1 whitespace-nowrap text-primary hover:text-secondary",target:"_blank",children:[i.substring(0,8),"…",i.slice(-6)]}),"to the Quest Chain contract at",t.jsxs("a",{href:`https://optimistic.etherscan.io/address/${d}`,className:"ml-1 whitespace-nowrap text-primary hover:text-secondary",target:"_blank",children:[d==null?void 0:d.substring(0,6),"…",d==null?void 0:d.slice(-4)]}),"."]}),{duration:12e3,style:{width:"45ch"}})},[i]);const{isLoading:x,isSuccess:N}=P({hash:i});e.reader==null&&!r.account?u(l.account):e.reader!=null&&r.account&&u({type:"account",error:null}),n!==L&&!r.chain?u(l.chain):n===L&&r.chain&&u({type:"chain",error:null});const k=Object.values(r).filter(Boolean);if(k.length>0)return k.map((o,m)=>t.jsx(ge,{children:o},m));const f=R.lazy(()=>H(()=>import("./MarkdownEditor-CKHqtHLe.js").then(o=>o.w),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),C="Submit Proof",g=x?"Confirming…":T?"Transaction Pending…":s?"Saving to IPFS…":N?"¡Done: Submitted!":C;return t.jsxs(y.Suspense,{fallback:t.jsx("h3",{children:"Loading Submission Editor…"}),children:[t.jsx(f,{editorRef:a,markdown:"",className:"dark-theme dark-editor content mt-10"}),t.jsxs("button",{onClick:async()=>{var m;const o=(m=a.current)==null?void 0:m.getMarkdown();if(!o)throw new Error(`Invalid \`markdown\`: "${o}".`);c(!0);try{const b=new Blob([JSON.stringify({name,description:o})],{type:"application/json"}),q=await V([new File([b],"submission.json")]);if(j.success(t.jsxs("p",{children:["Successfully uploaded your response submission to",t.jsx("a",{href:"https://web3.storage",target:"_blank",className:"mx-1 whitespace-nowrap text-primary hover:text-secondary",children:"Web3.Storage"}),"at",t.jsxs("a",{href:`https://w3s.link/ipfs/${q}`,target:"_blank",className:"ml-1 whitespace-nowrap text-primary hover:text-secondary",children:["ipfs://",q.substring(0,6),"…",q.slice(-4)]}),"."]}),{duration:15e3,position:"bottom-center",style:{width:"45ch"}}),e.on==null)throw new Error("No current chapter.");w({address:d,abi:O,functionName:"submitProofs",args:[[e.on-1],[`ipfs://${q}/submission.json`]]},{onError:_=>{console.error({error:_}),j.error(_.shortMessage??_.message,{duration:12e3})}})}catch(b){console.error({error:b}),j.error(b.message)}finally{c(!1)}},disabled:g!==C,className:"btn btn-wide text-primary my-6",children:[t.jsx("span",{className:v(g.endsWith("…")&&"loading loading-dots loading-md")}),g]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,n){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,n),n)}};function Te(){const e=M();return t.jsxs("section",{id:"content",className:"flex-grow",children:[t.jsx("div",{className:"card bg-transparent max-w-prose mt-4 mx-auto",children:t.jsx("div",{className:"content",children:t.jsx(ee,{children:e.chapters.active.content})})}),e.on===0?t.jsx("button",{onClick:()=>e.setOn(e.on+1),className:"shadow-md rounded-md bg-secondary p-4 hover:bg-blue-300/60 text-white text-center",children:"Continue"}):["pass"].includes(e.chapters.active.status)?t.jsxs("div",{role:"alert",className:"alert alert-success flex items-center mt-10",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 shrink-0 stroke-current",fill:"none",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),t.jsx("h2",{className:"grow",children:"You have already successfully completed this submission."}),e.on<e.chapters.length-1&&t.jsxs("button",{onClick:()=>e.setOn(e.on+1),className:"btn btn-primary text-fg font-bold self-end",children:["Next ",t.jsx("span",{className:"size-2xl",children:"→"})]})]}):t.jsx(we,{})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,n){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,n),n)}};const ve=()=>{var h;const e=M(),{data:n,writeContract:a}=B(),{isLoading:s,isSuccess:c}=P({hash:n}),[r,p]=y.useState(!1);if(!e)throw new Error("No book found.");const u=()=>{if(!e)throw new Error("No book found.");a({address:e.contract,abi:O,functionName:"mintToken",args:[]},{onError:l=>{console.error({error:l}),j.error(l.shortMessage??l.message,{duration:12e3})},onSuccess:l=>j.success(t.jsxs("p",{children:["Minted in transaction",t.jsxs("a",{href:`https://optimistic.etherscan.io/tx/${l}`,className:"mx-1 whitespace-nowrap text-primary hover:text-secondary",target:"_blank",children:[l.substring(0,8),"…",l.slice(-6)]}),"."]}),{duration:12e3})})};let i=((h=e.chapters)==null?void 0:h.every(l=>l.status==="pass"||l.optional))&&!e.nft.minted;const w="Mint NFT",T=s?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"loading loading-spinner loading-md"}),"Confirming…"]}):c?"¡Done: Minted!":w;return t.jsx("div",{id:"reward",className:"flex flex-col ml-4 mt-8 md:mt-1",children:t.jsxs("div",{className:"card rounded-sm bg-secondary/25 h-auto max-w-md mr-4 mx-auto",children:[t.jsx("h1",{className:"text-3xl font-bold text-center my-4 mx-2",children:"Completion NFT"}),t.jsx("img",{onLoad:()=>p(!0),src:G(e.nft.image),alt:"Soulbound NFT",className:"w-full h-full object-contain pb-4 px-4"}),!r&&t.jsx("div",{className:"grid place-items-center",children:t.jsx("span",{className:"loading-spinner loading loading-md"})}),i&&t.jsx("button",{disabled:e.nft.minted||T!==w,onClick:u,className:"btn btn-primary",children:T}),e.nft.minted&&t.jsx("h2",{className:"bg-blue-400 rounded-md p-4",children:"You've already collected this NFT."})]})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,n){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,n),n)}};const je=()=>{var s;const e=D(),[n,a]=y.useState("Unknown");if(y.useEffect(()=>{e&&"creator"in e&&(a(`${e.creator.substring(0,5)}⋯${e.creator.slice(-3)}`),pe({chain:J,transport:X()}).getEnsName({address:e.creator}).then(r=>{r&&a(r)}))}),e&&e.error)throw e.error;return t.jsxs("header",{children:[t.jsxs("h2",{className:"text-sm text-blue-500 mt-5 text-left pl-1",children:["Creator: ",n]}),t.jsx("h1",{className:"text-4xl md:text-6xl font-bold text-left mt-2",children:e==null?void 0:e.title}),t.jsxs("p",{className:"text-sm text-white text-left pl-1 mt-6 mb-4",children:["Last Updated:"," ",((s=e==null?void 0:e.updatedAt)==null?void 0:s.toLocaleString(void 0,{day:"numeric",month:"long",year:"numeric"}))??"Unknown"]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,n){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,n),n)}};const ke=Z("/book/$slug/$chapter/")({component:Ce});function Ce(){try{const{slug:e,chapter:n}=ke.useParams();return t.jsx(be,{chapter:Number(n),slug:e,children:t.jsxs("article",{id:"top",className:"container mx-auto py-20 px-8 lg:px-24 overflow-auto relative",children:[t.jsx(je,{}),t.jsx("main",{className:"md:flex justify-start overflow-hidden relative",children:t.jsxs(y.Suspense,{fallback:t.jsx("h1",{className:"mt-44",children:"Loading…"}),children:[t.jsx(xe,{}),t.jsx(Te,{}),t.jsx(ve,{})]})})]})})}catch(e){return t.jsxs("h1",{children:["Error: ",e.message]})}}export{Ce as Book,ke as Route};
