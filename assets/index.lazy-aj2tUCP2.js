import{f as u,g as y,j as h,e as I,L as k}from"./index-CjoznLbg.js";import{M as B}from"./MarkdownEditor-BhFIeZah.js";/* empty css                        */import{T as H}from"./Top-CHowlW6p.js";import{u as P}from"./useUsername-7UxMFdud.js";import{c as Y}from"./clsx-B4VjtFc_.js";import{u as X}from"./useAccount-D4UzpVhY.js";import"./utils-BLSEaUXj.js";import"./isAddressEqual-K9PEkNwb.js";import"./secp256k1-CRB5wlgU.js";const N=({index:s,header:t,contentHeader:e,onDelete:i,reloadCallback:n})=>{const r=u.useRef(null),[c,g]=y.useState(localStorage.getItem(`chapter.${s}.title`));return n==null||n(s,()=>{var a;g(localStorage.getItem(`chapter.${s}.title`)),(a=r.current)==null||a.setMarkdown(localStorage.getItem(`chapter.${s}.content`)??"")}),h.jsxs("fieldset",{className:"relative border border-secondary p-4 w-full",children:[h.jsx("legend",{className:"text-left",children:t??`Chapter ${s}`}),!!i&&h.jsx("button",{className:"absolute top-8 right-8",onClick:()=>i(s),children:"🗑️"}),h.jsxs("div",{id:`chapter-${s}-title`,className:"mb-4 bg-secondary/25 scroll-m-24",children:[h.jsx("h2",{children:"Title"}),h.jsx("input",{onChange:a=>{const{value:o}=a.target;localStorage.setItem(`chapter.${s}.title`,o),g(o)},value:c??"",id:"title",placeholder:"Title",className:"input input-bordered w-full max-w-xs my-2"})]}),h.jsx("div",{id:`chapter-${s}-content`,className:"mt-4 mb-4 bg-secondary/25 scroll-m-24",children:h.jsx("h2",{className:"mt-2",children:e??`Chapter ${s} Content`})}),h.jsx("div",{className:"flex justify-center",children:h.jsx(B,{editorRef:r,markdown:localStorage.getItem(`chapter.${s}.content`)??"",className:"dark-theme dark-editor content mt-4",onChange:()=>{var a;localStorage.setItem(`chapter.${s}.content`,((a=r.current)==null?void 0:a.getMarkdown())??"")}})})]})},M={x:0,y:0,width:0,height:0,unit:"px"},S=(s,t,e)=>Math.min(Math.max(s,t),e),_=(...s)=>s.filter(t=>t&&typeof t=="string").join(" "),$=(s,t)=>s===t||s.width===t.width&&s.height===t.height&&s.x===t.x&&s.y===t.y&&s.unit===t.unit;function A(s,t,e,i){const n=b(s,e,i);return s.width&&(n.height=n.width/t),s.height&&(n.width=n.height*t),n.y+n.height>i&&(n.height=i-n.y,n.width=n.height*t),n.x+n.width>e&&(n.width=e-n.x,n.height=n.width/t),s.unit==="%"?j(n,e,i):n}function K(s,t,e){const i=b(s,t,e);return i.x=(t-i.width)/2,i.y=(e-i.height)/2,s.unit==="%"?j(i,t,e):i}function j(s,t,e){return s.unit==="%"?{...M,...s,unit:"%"}:{unit:"%",x:s.x?s.x/t*100:0,y:s.y?s.y/e*100:0,width:s.width?s.width/t*100:0,height:s.height?s.height/e*100:0}}function b(s,t,e){return s.unit?s.unit==="px"?{...M,...s,unit:"px"}:{unit:"px",x:s.x?s.x*t/100:0,y:s.y?s.y*e/100:0,width:s.width?s.width*t/100:0,height:s.height?s.height*e/100:0}:{...M,...s,unit:"px"}}function E(s,t,e,i,n,r=0,c=0,g=i,a=n){const o={...s};let p=Math.min(r,i),l=Math.min(c,n),w=Math.min(g,i),d=Math.min(a,n);t&&(t>1?(p=c?c*t:p,l=p/t,w=g*t):(l=r?r/t:l,p=l*t,d=a/t)),o.y<0&&(o.height=Math.max(o.height+o.y,l),o.y=0),o.x<0&&(o.width=Math.max(o.width+o.x,p),o.x=0);const m=i-(o.x+o.width);m<0&&(o.x=Math.min(o.x,i-p),o.width+=m);const x=n-(o.y+o.height);if(x<0&&(o.y=Math.min(o.y,n-l),o.height+=x),o.width<p&&((e==="sw"||e=="nw")&&(o.x-=p-o.width),o.width=p),o.height<l&&((e==="nw"||e=="ne")&&(o.y-=l-o.height),o.height=l),o.width>w&&((e==="sw"||e=="nw")&&(o.x-=w-o.width),o.width=w),o.height>d&&((e==="nw"||e=="ne")&&(o.y-=d-o.height),o.height=d),t){const f=o.width/o.height;if(f<t){const C=Math.max(o.width/t,l);(e==="nw"||e=="ne")&&(o.y-=C-o.height),o.height=C}else if(f>t){const C=Math.max(o.height*t,p);(e==="sw"||e=="nw")&&(o.x-=C-o.width),o.width=C}}return o}function L(s,t,e,i){const n={...s};return t==="ArrowLeft"?i==="nw"?(n.x-=e,n.y-=e,n.width+=e,n.height+=e):i==="w"?(n.x-=e,n.width+=e):i==="sw"?(n.x-=e,n.width+=e,n.height+=e):i==="ne"?(n.y+=e,n.width-=e,n.height-=e):i==="e"?n.width-=e:i==="se"&&(n.width-=e,n.height-=e):t==="ArrowRight"&&(i==="nw"?(n.x+=e,n.y+=e,n.width-=e,n.height-=e):i==="w"?(n.x+=e,n.width-=e):i==="sw"?(n.x+=e,n.width-=e,n.height-=e):i==="ne"?(n.y-=e,n.width+=e,n.height+=e):i==="e"?n.width+=e:i==="se"&&(n.width+=e,n.height+=e)),t==="ArrowUp"?i==="nw"?(n.x-=e,n.y-=e,n.width+=e,n.height+=e):i==="n"?(n.y-=e,n.height+=e):i==="ne"?(n.y-=e,n.width+=e,n.height+=e):i==="sw"?(n.x+=e,n.width-=e,n.height-=e):i==="s"?n.height-=e:i==="se"&&(n.width-=e,n.height-=e):t==="ArrowDown"&&(i==="nw"?(n.x+=e,n.y+=e,n.width-=e,n.height-=e):i==="n"?(n.y+=e,n.height-=e):i==="ne"?(n.y+=e,n.width-=e,n.height-=e):i==="sw"?(n.x-=e,n.width+=e,n.height+=e):i==="s"?n.height+=e:i==="se"&&(n.width+=e,n.height+=e)),n}const R={capture:!0,passive:!1};let U=0;const D=class v extends y.PureComponent{constructor(){super(...arguments),this.docMoveBound=!1,this.mouseDownOnCrop=!1,this.dragStarted=!1,this.evData={startClientX:0,startClientY:0,startCropX:0,startCropY:0,clientX:0,clientY:0,isResize:!0},this.componentRef=y.createRef(),this.mediaRef=y.createRef(),this.initChangeCalled=!1,this.instanceId=`rc-${U++}`,this.state={cropIsActive:!1,newCropIsBeingDrawn:!1},this.onCropPointerDown=t=>{const{crop:e,disabled:i}=this.props,n=this.getBox();if(!e)return;const r=b(e,n.width,n.height);if(i)return;t.cancelable&&t.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const c=t.target.dataset.ord,g=!!c;let a=t.clientX,o=t.clientY,p=r.x,l=r.y;if(c){const w=t.clientX-n.x,d=t.clientY-n.y;let m=0,x=0;c==="ne"||c=="e"?(m=w-(r.x+r.width),x=d-r.y,p=r.x,l=r.y+r.height):c==="se"||c==="s"?(m=w-(r.x+r.width),x=d-(r.y+r.height),p=r.x,l=r.y):c==="sw"||c=="w"?(m=w-r.x,x=d-(r.y+r.height),p=r.x+r.width,l=r.y):(c==="nw"||c=="n")&&(m=w-r.x,x=d-r.y,p=r.x+r.width,l=r.y+r.height),a=p+n.x+m,o=l+n.y+x}this.evData={startClientX:a,startClientY:o,startCropX:p,startCropY:l,clientX:t.clientX,clientY:t.clientY,isResize:g,ord:c},this.mouseDownOnCrop=!0,this.setState({cropIsActive:!0})},this.onComponentPointerDown=t=>{const{crop:e,disabled:i,locked:n,keepSelection:r,onChange:c}=this.props,g=this.getBox();if(i||n||r&&e)return;t.cancelable&&t.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const a=t.clientX-g.x,o=t.clientY-g.y,p={unit:"px",x:a,y:o,width:0,height:0};this.evData={startClientX:t.clientX,startClientY:t.clientY,startCropX:a,startCropY:o,clientX:t.clientX,clientY:t.clientY,isResize:!0},this.mouseDownOnCrop=!0,c(b(p,g.width,g.height),j(p,g.width,g.height)),this.setState({cropIsActive:!0,newCropIsBeingDrawn:!0})},this.onDocPointerMove=t=>{const{crop:e,disabled:i,onChange:n,onDragStart:r}=this.props,c=this.getBox();if(i||!e||!this.mouseDownOnCrop)return;t.cancelable&&t.preventDefault(),this.dragStarted||(this.dragStarted=!0,r&&r(t));const{evData:g}=this;g.clientX=t.clientX,g.clientY=t.clientY;let a;g.isResize?a=this.resizeCrop():a=this.dragCrop(),$(e,a)||n(b(a,c.width,c.height),j(a,c.width,c.height))},this.onComponentKeyDown=t=>{const{crop:e,disabled:i,onChange:n,onComplete:r}=this.props;if(i)return;const c=t.key;let g=!1;if(!e)return;const a=this.getBox(),o=this.makePixelCrop(a),p=(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)?v.nudgeStepLarge:t.shiftKey?v.nudgeStepMedium:v.nudgeStep;if(c==="ArrowLeft"?(o.x-=p,g=!0):c==="ArrowRight"?(o.x+=p,g=!0):c==="ArrowUp"?(o.y-=p,g=!0):c==="ArrowDown"&&(o.y+=p,g=!0),g){t.cancelable&&t.preventDefault(),o.x=S(o.x,0,a.width-o.width),o.y=S(o.y,0,a.height-o.height);const l=b(o,a.width,a.height),w=j(o,a.width,a.height);n(l,w),r&&r(l,w)}},this.onHandlerKeyDown=(t,e)=>{const{aspect:i=0,crop:n,disabled:r,minWidth:c=0,minHeight:g=0,maxWidth:a,maxHeight:o,onChange:p,onComplete:l}=this.props,w=this.getBox();if(r||!n)return;if(t.key==="ArrowUp"||t.key==="ArrowDown"||t.key==="ArrowLeft"||t.key==="ArrowRight")t.stopPropagation(),t.preventDefault();else return;const d=(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)?v.nudgeStepLarge:t.shiftKey?v.nudgeStepMedium:v.nudgeStep,m=b(n,w.width,w.height),x=L(m,t.key,d,e),f=E(x,i,e,w.width,w.height,c,g,a,o);if(!$(n,f)){const C=j(f,w.width,w.height);p(f,C),l&&l(f,C)}},this.onDocPointerDone=t=>{const{crop:e,disabled:i,onComplete:n,onDragEnd:r}=this.props,c=this.getBox();this.unbindDocMove(),!(i||!e)&&this.mouseDownOnCrop&&(this.mouseDownOnCrop=!1,this.dragStarted=!1,r&&r(t),n&&n(b(e,c.width,c.height),j(e,c.width,c.height)),this.setState({cropIsActive:!1,newCropIsBeingDrawn:!1}))},this.onDragFocus=()=>{var t;(t=this.componentRef.current)==null||t.scrollTo(0,0)}}get document(){return document}getBox(){const t=this.mediaRef.current;if(!t)return{x:0,y:0,width:0,height:0};const{x:e,y:i,width:n,height:r}=t.getBoundingClientRect();return{x:e,y:i,width:n,height:r}}componentDidUpdate(t){const{crop:e,onComplete:i}=this.props;if(i&&!t.crop&&e){const{width:n,height:r}=this.getBox();n&&r&&i(b(e,n,r),j(e,n,r))}}componentWillUnmount(){this.resizeObserver&&this.resizeObserver.disconnect(),this.unbindDocMove()}bindDocMove(){this.docMoveBound||(this.document.addEventListener("pointermove",this.onDocPointerMove,R),this.document.addEventListener("pointerup",this.onDocPointerDone,R),this.document.addEventListener("pointercancel",this.onDocPointerDone,R),this.docMoveBound=!0)}unbindDocMove(){this.docMoveBound&&(this.document.removeEventListener("pointermove",this.onDocPointerMove,R),this.document.removeEventListener("pointerup",this.onDocPointerDone,R),this.document.removeEventListener("pointercancel",this.onDocPointerDone,R),this.docMoveBound=!1)}getCropStyle(){const{crop:t}=this.props;if(t)return{top:`${t.y}${t.unit}`,left:`${t.x}${t.unit}`,width:`${t.width}${t.unit}`,height:`${t.height}${t.unit}`}}dragCrop(){const{evData:t}=this,e=this.getBox(),i=this.makePixelCrop(e),n=t.clientX-t.startClientX,r=t.clientY-t.startClientY;return i.x=S(t.startCropX+n,0,e.width-i.width),i.y=S(t.startCropY+r,0,e.height-i.height),i}getPointRegion(t,e,i,n){const{evData:r}=this,c=r.clientX-t.x,g=r.clientY-t.y;let a;n&&e?a=e==="nw"||e==="n"||e==="ne":a=g<r.startCropY;let o;return i&&e?o=e==="nw"||e==="w"||e==="sw":o=c<r.startCropX,o?a?"nw":"sw":a?"ne":"se"}resolveMinDimensions(t,e,i=0,n=0){const r=Math.min(i,t.width),c=Math.min(n,t.height);return!e||!r&&!c?[r,c]:e>1?r?[r,r/e]:[c*e,c]:c?[c*e,c]:[r,r/e]}resizeCrop(){const{evData:t}=this,{aspect:e=0,maxWidth:i,maxHeight:n}=this.props,r=this.getBox(),[c,g]=this.resolveMinDimensions(r,e,this.props.minWidth,this.props.minHeight);let a=this.makePixelCrop(r);const o=this.getPointRegion(r,t.ord,c,g),p=t.ord||o;let l=t.clientX-t.startClientX,w=t.clientY-t.startClientY;(c&&p==="nw"||p==="w"||p==="sw")&&(l=Math.min(l,-c)),(g&&p==="nw"||p==="n"||p==="ne")&&(w=Math.min(w,-g));const d={unit:"px",x:0,y:0,width:0,height:0};o==="ne"?(d.x=t.startCropX,d.width=l,e?(d.height=d.width/e,d.y=t.startCropY-d.height):(d.height=Math.abs(w),d.y=t.startCropY-d.height)):o==="se"?(d.x=t.startCropX,d.y=t.startCropY,d.width=l,e?d.height=d.width/e:d.height=w):o==="sw"?(d.x=t.startCropX+l,d.y=t.startCropY,d.width=Math.abs(l),e?d.height=d.width/e:d.height=w):o==="nw"&&(d.x=t.startCropX+l,d.width=Math.abs(l),e?(d.height=d.width/e,d.y=t.startCropY-d.height):(d.height=Math.abs(w),d.y=t.startCropY+w));const m=E(d,e,o,r.width,r.height,c,g,i,n);return e||v.xyOrds.indexOf(p)>-1?a=m:v.xOrds.indexOf(p)>-1?(a.x=m.x,a.width=m.width):v.yOrds.indexOf(p)>-1&&(a.y=m.y,a.height=m.height),a.x=S(a.x,0,r.width-a.width),a.y=S(a.y,0,r.height-a.height),a}renderCropSelection(){const{ariaLabels:t=v.defaultProps.ariaLabels,disabled:e,locked:i,renderSelectionAddon:n,ruleOfThirds:r,crop:c}=this.props,g=this.getCropStyle();if(c)return u.createElement("div",{style:g,className:"ReactCrop__crop-selection",onPointerDown:this.onCropPointerDown,"aria-label":t.cropArea,tabIndex:0,onKeyDown:this.onComponentKeyDown,role:"group"},!e&&!i&&u.createElement("div",{className:"ReactCrop__drag-elements",onFocus:this.onDragFocus},u.createElement("div",{className:"ReactCrop__drag-bar ord-n","data-ord":"n"}),u.createElement("div",{className:"ReactCrop__drag-bar ord-e","data-ord":"e"}),u.createElement("div",{className:"ReactCrop__drag-bar ord-s","data-ord":"s"}),u.createElement("div",{className:"ReactCrop__drag-bar ord-w","data-ord":"w"}),u.createElement("div",{className:"ReactCrop__drag-handle ord-nw","data-ord":"nw",tabIndex:0,"aria-label":t.nwDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"nw"),role:"button"}),u.createElement("div",{className:"ReactCrop__drag-handle ord-n","data-ord":"n",tabIndex:0,"aria-label":t.nDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"n"),role:"button"}),u.createElement("div",{className:"ReactCrop__drag-handle ord-ne","data-ord":"ne",tabIndex:0,"aria-label":t.neDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"ne"),role:"button"}),u.createElement("div",{className:"ReactCrop__drag-handle ord-e","data-ord":"e",tabIndex:0,"aria-label":t.eDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"e"),role:"button"}),u.createElement("div",{className:"ReactCrop__drag-handle ord-se","data-ord":"se",tabIndex:0,"aria-label":t.seDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"se"),role:"button"}),u.createElement("div",{className:"ReactCrop__drag-handle ord-s","data-ord":"s",tabIndex:0,"aria-label":t.sDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"s"),role:"button"}),u.createElement("div",{className:"ReactCrop__drag-handle ord-sw","data-ord":"sw",tabIndex:0,"aria-label":t.swDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"sw"),role:"button"}),u.createElement("div",{className:"ReactCrop__drag-handle ord-w","data-ord":"w",tabIndex:0,"aria-label":t.wDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"w"),role:"button"})),n&&u.createElement("div",{className:"ReactCrop__selection-addon",onPointerDown:a=>a.stopPropagation()},n(this.state)),r&&u.createElement(u.Fragment,null,u.createElement("div",{className:"ReactCrop__rule-of-thirds-hz"}),u.createElement("div",{className:"ReactCrop__rule-of-thirds-vt"})))}makePixelCrop(t){const e={...M,...this.props.crop||{}};return b(e,t.width,t.height)}render(){const{aspect:t,children:e,circularCrop:i,className:n,crop:r,disabled:c,locked:g,style:a,ruleOfThirds:o}=this.props,{cropIsActive:p,newCropIsBeingDrawn:l}=this.state,w=r?this.renderCropSelection():null,d=_("ReactCrop",n,p&&"ReactCrop--active",c&&"ReactCrop--disabled",g&&"ReactCrop--locked",l&&"ReactCrop--new-crop",r&&t&&"ReactCrop--fixed-aspect",r&&i&&"ReactCrop--circular-crop",r&&o&&"ReactCrop--rule-of-thirds",!this.dragStarted&&r&&!r.width&&!r.height&&"ReactCrop--invisible-crop",i&&"ReactCrop--no-animate");return u.createElement("div",{ref:this.componentRef,className:d,style:a},u.createElement("div",{ref:this.mediaRef,className:"ReactCrop__child-wrapper",onPointerDown:this.onComponentPointerDown},e),r?u.createElement("svg",{className:"ReactCrop__crop-mask",width:"100%",height:"100%"},u.createElement("defs",null,u.createElement("mask",{id:`hole-${this.instanceId}`},u.createElement("rect",{width:"100%",height:"100%",fill:"white"}),i?u.createElement("ellipse",{cx:`${r.x+r.width/2}${r.unit}`,cy:`${r.y+r.height/2}${r.unit}`,rx:`${r.width/2}${r.unit}`,ry:`${r.height/2}${r.unit}`,fill:"black"}):u.createElement("rect",{x:`${r.x}${r.unit}`,y:`${r.y}${r.unit}`,width:`${r.width}${r.unit}`,height:`${r.height}${r.unit}`,fill:"black"}))),u.createElement("rect",{fill:"black",fillOpacity:.5,width:"100%",height:"100%",mask:`url(#hole-${this.instanceId})`})):void 0,w)}};D.xOrds=["e","w"],D.yOrds=["n","s"],D.xyOrds=["nw","ne","se","sw"],D.nudgeStep=1,D.nudgeStepMedium=10,D.nudgeStepLarge=100,D.defaultProps={ariaLabels:{cropArea:"Use the arrow keys to move the crop selection area",nwDragHandle:"Use the arrow keys to move the north west drag handle to change the crop selection area",nDragHandle:"Use the up and down arrow keys to move the north drag handle to change the crop selection area",neDragHandle:"Use the arrow keys to move the north east drag handle to change the crop selection area",eDragHandle:"Use the up and down arrow keys to move the east drag handle to change the crop selection area",seDragHandle:"Use the arrow keys to move the south east drag handle to change the crop selection area",sDragHandle:"Use the up and down arrow keys to move the south drag handle to change the crop selection area",swDragHandle:"Use the arrow keys to move the south west drag handle to change the crop selection area",wDragHandle:"Use the up and down arrow keys to move the west drag handle to change the crop selection area"}};let O=D;function z(s,t,e){return K(A({unit:"%",width:100},e,s,t),s,t)}function T(){const[s,t]=y.useState(""),e=y.useRef(null),[i,n]=y.useState(localStorage.getItem("cover")),[r,c]=y.useState(),g={width:320,height:480};function a(l){if(l.target.files&&l.target.files.length>0){n(null),c(void 0);const w=new FileReader;w.addEventListener("load",()=>{var d;return t(((d=w.result)==null?void 0:d.toString())||"")}),w.readAsDataURL(l.target.files[0])}}function o(l){if(g){const{width:w,height:d}=l.currentTarget;c(z(w,d,g.width/g.height))}}async function p(){const l=e.current;if(!l||!r)throw new Error("Crop canvas does not exist.");const w=document.createElement("canvas");w.width=g.width,w.height=g.height;const d=w.getContext("2d");if(!d)throw new Error("No 2d context");r.unit==="px"&&(r.x=r.x/l.width*100,r.y=r.y/l.height*100,r.width=r.width/l.width*100,r.height=r.height/l.height*100),d.imageSmoothingQuality="high";const m={x:l.naturalWidth*(r.x/100),y:l.naturalHeight*(r.y/100)};d.drawImage(l,m.x,m.y,l.naturalWidth*(r.width/100),l.naturalHeight*(r.height/100),0,0,w.width,w.height);const x=w.toDataURL("image/jpeg");localStorage.setItem("cover",x),n(x)}return h.jsxs("div",{className:"",children:[h.jsx("div",{className:"Crop-Controls",children:h.jsxs("label",{className:"flex justify-center mt-4 tooltip","data-tip":i?"Click to change image.":null,children:[i&&h.jsx("img",{src:i,alt:"Crop Preview",className:"max-h-[50vh]"}),h.jsx("input",{type:"file",accept:"image/*",onChange:a,className:Y(!!i&&"hidden","file-input file-input-bordered w-full max-w-xs")})]})}),!!s&&!i&&h.jsx(O,{crop:r,onChange:l=>c(l),aspect:g.width/g.height,minHeight:100,className:"max-h-[50vh]",children:h.jsx("img",{ref:e,alt:"Crop me",src:s,onLoad:o})}),!!r&&!i&&h.jsx(h.Fragment,{children:h.jsx("div",{children:h.jsx("button",{className:"btn btn-secondary rounded-md btn-sm my-4",onClick:p,children:"Crop"})})})]})}const F=()=>h.jsx(T,{}),W=({bg:s,title:t})=>{const[e,i]=y.useState(),[n,r]=y.useState(),[c,g]=y.useState(),[a,o]=y.useState(1);y.useEffect(()=>{if(s){const m=new FileReader;m.onload=()=>{let{result:x}=m;x instanceof ArrayBuffer&&(x=new String(x)),i(x)},m.readAsDataURL(s)}},[s]);const p=m=>{const x=document.querySelector("#nft");if(x){const f=x.createSVGPoint();f.x=m.x??0,f.y=m.y??0;const C=x.getScreenCTM();if(C)return f.matrixTransform(C.inverse())}},l=m=>{r(p({x:m.clientX,y:m.clientY}))},w=()=>{r(void 0)},d=m=>{if(n){const x=p({x:m.clientX,y:m.clientY});if(g(x),x){const f=(n.y-x.y)/200;o(f<0?100+f:f)}}};return h.jsxs("svg",{onMouseMove:d,onMouseUp:w,onMouseDown:l,version:"1.1",viewBox:"0 0 200 200",xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"100%",id:"nft",children:[h.jsxs("defs",{children:[e&&h.jsx("image",{height:`${a*100}%`,width:`${a*100}%`,id:"bg",href:e}),h.jsx("filter",{id:"blur",colorInterpolationFilters:"sRGB",children:h.jsx("feGaussianBlur",{stdDeviation:"2"})}),h.jsx("rect",{id:"textBox",x:"15%",y:"80%",width:"70%",height:"13%",rx:"4%"}),h.jsx("clipPath",{id:"textClip",children:h.jsx("use",{href:"#textBox"})})]}),e&&h.jsx("g",{children:h.jsx("use",{height:"100%",width:"100%",href:"#bg"})}),t&&h.jsxs(h.Fragment,{children:[h.jsx("use",{filter:"url(#blur)",clipPath:"url(#textClip)",href:"#bg",height:"100%",width:"100%"}),h.jsx("use",{href:"#textBox",fill:"#fff",fillOpacity:".25",filter:"url(#blur)"}),h.jsx("text",{x:"50%",y:"90%",fill:"#fff",fontSize:"133%",stroke:"#0005",strokeWidth:".5",textAnchor:"middle",style:{fontVariationSettings:"'wdth' 87, 'wght' 500"},children:t})]}),n&&c&&h.jsxs("g",{children:[h.jsx("line",{x1:n.x,x2:c.x,y1:n.y,y2:c.y,stroke:"green",strokeDasharray:"1 1"}),h.jsx("circle",{cx:c.x,cy:c.y,r:"1%",fill:"red"})]}),n&&h.jsx("circle",{cx:n.x,cy:n.y,r:"1%",fill:"red"})]})},G=()=>{const[s,t]=y.useState(),[e,i]=y.useState();return h.jsxs("dialog",{open:!0,children:[h.jsx("input",{onChange:({target:{files:n}})=>t(n==null?void 0:n[0]),type:"file",accept:"image/*"}),h.jsx("input",{placeholder:"title",value:e,onChange:({target:{value:n}})=>i(n)}),h.jsx(W,{bg:s,title:e})]})},oe=I("/upload/")({component:()=>{const{address:s}=X(),{ens:t,error:e}=P(s),[i,n]=y.useState((()=>{let a=0;for(;localStorage.getItem(`chapter.${a}.title`)!=null;)a++;return Math.max(2,a)})()),r=y.useRef([]);if(e)return h.jsx("h1",{children:e});const c=a=>{console.group("looping");for(let o=a;o<i-1;o++)console.log({idx:o,chapterCount:i}),localStorage.setItem(`chapter.${o}.title`,localStorage.getItem(`chapter.${o+1}.title`)??""),localStorage.setItem(`chapter.${o}.content`,localStorage.getItem(`chapter.${o+1}.content`)??""),r.current[o].call(r.current[o]);console.groupEnd(),i>2?(localStorage.removeItem(`chapter.${i-1}.title`),localStorage.removeItem(`chapter.${i-1}.content`),n(i-1)):(localStorage.setItem(`chapter.${i-1}.title`,""),localStorage.setItem(`chapter.${i-1}.content`,"")),r.current[i-1].call(r.current[i-1])},g=(a,o)=>{r.current[a]=o};return h.jsxs("div",{children:[h.jsx("h1",{id:"top",className:"text-2xl font-semibold text-secondary mt-12 mb-8 scroll-m-24",children:"Upload Hub"}),h.jsxs("div",{className:"drawer lg:drawer-open",children:[h.jsx("input",{id:"my-drawer-2",type:"checkbox",className:"drawer-toggle"}),h.jsxs("div",{className:"drawer-content flex flex-col items-center justify-start md:px-8",children:[h.jsxs("div",{id:"book-cover",className:"mt-4 mb-4 w-full bg-secondary/25 scroll-m-24",children:[h.jsx("h1",{className:"mt-2",children:"Select Cover"}),h.jsx(F,{})]}),h.jsx(N,{index:0,header:"Book",contentHeader:"Introduction"}),Array.from({length:i-1},(a,o)=>y.createElement(N,{reloadCallback:g,onDelete:c,key:o,index:o+1})),h.jsx("button",{onClick:()=>n(i+1),className:"btn btn-md rounded-md btn-secondary",children:"Add Chapter"}),h.jsx(G,{}),h.jsx("label",{htmlFor:"my-drawer-2",className:"btn btn-xs btn-secondary border border-primary drawer-button lg:hidden fixed left-0 mt-40 z-10",children:"⇒"})]}),h.jsxs("div",{className:"drawer-side",children:[h.jsx("label",{htmlFor:"my-drawer-2","aria-label":"close sidebar",className:"drawer-overlay"}),h.jsxs("ul",{className:"menu bg-base-200 text-base-content w-80 p-4 mt-28 z-20",children:[h.jsx("h1",{className:"mt-4 mb-4 text-lg font-secondary",children:t}),h.jsx("li",{children:h.jsx(k,{to:"#book-cover",children:"Upload Cover"})}),h.jsx("li",{children:h.jsx(k,{to:"#book-title",children:"Book Title"})}),h.jsx("li",{children:h.jsx(k,{to:"#introduction",children:"Book Introduction"})}),h.jsx("li",{children:h.jsx(k,{to:"#chapters",children:"Chapters"})}),h.jsx("li",{children:h.jsx("a",{children:"Owner Permissions"})})]})]})]}),h.jsx(H,{})]})}});export{oe as Route};
