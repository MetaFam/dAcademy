const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MarkdownEditor-ixLsFA0w.js","assets/index-qFgN0BDJ.js","assets/index-D5RiU3l6.css","assets/index-DLtqUfxH.js","assets/isAddressEqual-DOxjMwtg.js","assets/secp256k1-DmO-as0P.js","assets/index-BdGbLepL.js","assets/useConfig-BxwOpbe6.js","assets/index-C1SvVhsi.js","assets/index-DaLVO-yr.js","assets/index-B8RrAdm8.js","assets/tslib.es6-B2dMZmZB.js","assets/index-Da2sJjOt.js"])))=>i.map(i=>d[i]);
var U=Object.defineProperty;var z=(e,n,s)=>n in e?U(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s;var _=(e,n,s)=>z(e,typeof n!="symbol"?n+"":n,s);import{N as W,r as y,j as t,f as T,b as K,R,_ as v,O as Y,o as H,v as V,h as G,a as J}from"./index-qFgN0BDJ.js";import{u as E,M as X}from"./index-DKoJXUE6.js";import{g as S,r as A}from"./gql-DHmsBT2a.js";import{d as Q,b as Z,w as ee}from"./index-BdGbLepL.js";import{u as te}from"./useAccount-eqPDiuCN.js";import{f as ne,u as se,T as ae,a as ie,b as re,d as oe,e as le,c as ue,m as ce}from"./index-DLtqUfxH.js";import{u as $}from"./markdown-editor-D4CeGnSr.js";import{u as B}from"./useConfig-BxwOpbe6.js";import"./isAddressEqual-DOxjMwtg.js";import"./secp256k1-DmO-as0P.js";import"./index-C1SvVhsi.js";import"./index-DaLVO-yr.js";function pe(e,n={}){return{async queryFn({queryKey:s}){const{hash:a,...l}=s[1];if(!a)throw new Error("hash is required");return W(e,{...l,onReplaced:n.onReplaced,hash:a})},queryKey:de(n)}}function de(e={}){const{onReplaced:n,...s}=e;return["waitForTransactionReceipt",ne(s)]}function D(e={}){const{hash:n,query:s={}}=e,a=B(e),l=Q({config:a}),r=pe(a,{...e,chainId:e.chainId??l}),p=!!(n&&(s.enabled??!0));return se({...s,...r,enabled:p})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,n){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,n),n)}};const ye=S`
  query ChainDetails($slug: String!, $reader: ID) {
    questChains(where: { slug: $slug }) {
      id
      name
      address
      description
      imageUrl
      token {
        tokenId
        imageUrl
        tokenAddress
        owners(where: { id: $reader }) {
          id
        }
      }
      createdBy {
        id
      }
      updatedAt
      quests(orderBy: questId) {
        questId
        name
        description
        optional
        status { status }
      }
    }
  }
`,me=S`
  query ChainDetails($chain: String!, $user: String!) {
    questStatuses(where: {
      questChain: $chain, user: $user
    }, orderBy: quest__questId) {
      status
      quest {
        questId
        paused
      }
      submissions {
        name
        description
        details
        externalUrl
      }
    }
  }
`;class he extends Array{constructor(...s){super();_(this,"current",0);this.push(...s)}get active(){return this[this.current]}}const F=y.createContext(null),P=()=>y.useContext(F),q=()=>{const e=P();if(!e)throw new Error("No book.");if(e.status==="error")throw e.error;if(e.status==="init")throw new Error(`Loading Book: "${e.slug}".`);return e},fe=({slug:e,children:n,chapter:s=0})=>{var j;const[a,l]=y.useState(s),r=Z(),p=te(),c=((j=p==null?void 0:p.address)==null?void 0:j.toLowerCase())??null,{data:{questChains:[i]=[]}={},error:x,isLoading:w}=E({queryKey:[`chain-${e}`],queryFn:async()=>A(r,ye,{slug:e,reader:c})});if(!i)throw new Error(`No subgraph entry found for "${e}".`);const{data:h,error:u}=E({queryKey:[`statuses-${i==null?void 0:i.id}-${c}`],queryFn:async()=>!c||!(i!=null&&i.id)?null:A(r,me,{chain:i.id,user:c})}),{questStatuses:d}=h??{};let b=null;const C=x??u;if(C)b={status:"error",error:C};else if(w)b={status:"init",slug:e};else{const N=new he({optional:!0,title:"Introduction",content:i.description,status:"init"},...i.quests.map((g,o)=>{const m=d==null?void 0:d.find(({quest:{questId:f}})=>Number(f)===o);return{optional:g.optional,title:g.name,content:g.description,status:(m==null?void 0:m.status)??null}}));N.current=a;const k={slug:e,title:i.name,introduction:i.description,chapters:N,creator:i.createdBy.id,owners:[],updatedAt:new Date(Number(i.updatedAt)*1e3),contract:i.id,nft:{id:Number(i.token.tokenId),address:i.token.tokenAddress,image:i.token.imageUrl,minted:i.token.owners.length>0},on:a,setOn:l};c===null?b={status:"load",...k,reader:c}:b={status:"auth",...k,reader:c}}return t.jsx(F.Provider,{value:b,children:n})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,n){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,n),n)}};function be(){const e=q();return t.jsx("ol",{id:"chapters",className:"flex flex-col max-w-72 text-balance mt-4 mr-4 sticky top-0 z-50",children:e.chapters.map((n,s)=>{const{status:a}=n;let l=a==null?"You have not yet submitted a proof for this chapter.":`Your submission ${(()=>{switch(a){case"pass":return"has been approved.";case"fail":return"has been rejected.";case"review":return"is under review.";default:return`has a \`state\` of "${a}".`}})()}`,r=(()=>{switch(a){case"pass":return"fill-green-500";case"fail":return"fill-red-500";case"review":return"fill-orange-400";case"init":return"fill-secondary";case null:case void 0:return"fill-blue-400";default:return console.warn(`Unknown \`state\`: "${a}".`),"fill-blue-600"}})();return s===0&&(l="No submission required for this chapter.",r="fill-yellow-500"),t.jsx(ae,{children:t.jsxs(ie,{children:[t.jsx(re,{children:t.jsx("li",{onClick:()=>{var p;return(p=e.setOn)==null?void 0:p.call(e,s)},className:T("card shadow-md p-3 hover:bg-yellow-300/75 hover:text-black"),children:t.jsxs(K,{to:`../${s}`,className:"flex",children:[t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 50 50",className:"w-8 h-8 flex-shrink-0 mr-2 self-center",children:[t.jsx("circle",{cx:"50%",cy:"50%",r:"40%",className:r,stroke:T(n.optional?"#A44F":"#000B"),strokeWidth:8,strokeDasharray:T(n.optional&&"5 15"),strokeLinecap:"round",paintOrder:"stroke fill"}),t.jsx("text",{x:"50%",y:"57%",fontSize:"2.5rem",textAnchor:"middle",dominantBaseline:"middle",className:"fill-black font-bold",children:s+1})]}),t.jsx("h2",{className:"text-lg font-medium text-left",children:n.title})]})},s)}),t.jsxs(oe,{side:"right",className:T("card shadow-md p-3 hover:bg-yellow-300/75 hover:text-black",a==="pass"&&"bg-success",a==="fail"&&"bg-error",a==="review"&&"bg-info",a==="init"&&"bg-secondary text-white",a==null&&"bg-primary"),children:[l,t.jsx(le,{width:11,height:5,className:T("",a==="pass"&&"fill-success",a==="fail"&&"fill-error",a==="review"&&"fill-info",a==="init"&&"fill-secondary text-white",a==null&&"fill-primary")})]})]})},s)})})}const O=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"editor",type:"address"},{indexed:!1,internalType:"uint256[]",name:"questIdList",type:"uint256[]"},{components:[{internalType:"bool",name:"paused",type:"bool"},{internalType:"bool",name:"optional",type:"bool"},{internalType:"bool",name:"skipReview",type:"bool"}],indexed:!1,internalType:"struct IQuestChain.QuestDetails[]",name:"questDetails",type:"tuple[]"}],name:"ConfiguredQuests",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint8",name:"version",type:"uint8"}],name:"Initialized",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"account",type:"address"}],name:"Paused",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"editor",type:"address"},{indexed:!1,internalType:"string",name:"details",type:"string"}],name:"QuestChainEdited",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"string",name:"details",type:"string"},{indexed:!1,internalType:"string[]",name:"quests",type:"string[]"},{indexed:!1,internalType:"bool",name:"paused",type:"bool"}],name:"QuestChainInit",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"string",name:"tokenURI",type:"string"}],name:"QuestChainTokenURIUpdated",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"reviewer",type:"address"},{indexed:!1,internalType:"address[]",name:"questerList",type:"address[]"},{indexed:!1,internalType:"uint256[]",name:"questIdList",type:"uint256[]"},{indexed:!1,internalType:"bool[]",name:"successList",type:"bool[]"},{indexed:!1,internalType:"string[]",name:"detailsList",type:"string[]"}],name:"QuestProofsReviewed",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"quester",type:"address"},{indexed:!1,internalType:"uint256[]",name:"questIdList",type:"uint256[]"},{indexed:!1,internalType:"string[]",name:"proofList",type:"string[]"}],name:"QuestProofsSubmitted",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"creator",type:"address"},{indexed:!1,internalType:"string[]",name:"detailsList",type:"string[]"}],name:"QuestsCreated",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"editor",type:"address"},{indexed:!1,internalType:"uint256[]",name:"questIdList",type:"uint256[]"},{indexed:!1,internalType:"string[]",name:"detailsList",type:"string[]"}],name:"QuestsEdited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"role",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"previousAdminRole",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"newAdminRole",type:"bytes32"}],name:"RoleAdminChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"role",type:"bytes32"},{indexed:!0,internalType:"address",name:"account",type:"address"},{indexed:!0,internalType:"address",name:"sender",type:"address"}],name:"RoleGranted",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"role",type:"bytes32"},{indexed:!0,internalType:"address",name:"account",type:"address"},{indexed:!0,internalType:"address",name:"sender",type:"address"}],name:"RoleRevoked",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"limiterContract",type:"address"}],name:"SetLimiter",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"account",type:"address"}],name:"Unpaused",type:"event"},{inputs:[],name:"ADMIN_ROLE",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"DEFAULT_ADMIN_ROLE",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"EDITOR_ROLE",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"REVIEWER_ROLE",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"burnToken",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256[]",name:"_questIdList",type:"uint256[]"},{components:[{internalType:"bool",name:"paused",type:"bool"},{internalType:"bool",name:"optional",type:"bool"},{internalType:"bool",name:"skipReview",type:"bool"}],internalType:"struct IQuestChain.QuestDetails[]",name:"_questDetails",type:"tuple[]"}],name:"configureQuests",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"string[]",name:"_detailsList",type:"string[]"}],name:"createQuests",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"string",name:"_details",type:"string"}],name:"edit",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256[]",name:"_questIdList",type:"uint256[]"},{internalType:"string[]",name:"_detailsList",type:"string[]"}],name:"editQuests",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"}],name:"getRoleAdmin",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"getTokenURI",outputs:[{internalType:"string",name:"uri",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"_role",type:"bytes32"},{internalType:"address",name:"_account",type:"address"}],name:"grantRole",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"},{internalType:"address",name:"account",type:"address"}],name:"hasRole",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"address[]",name:"owners",type:"address[]"},{internalType:"address[]",name:"admins",type:"address[]"},{internalType:"address[]",name:"editors",type:"address[]"},{internalType:"address[]",name:"reviewers",type:"address[]"},{internalType:"string[]",name:"quests",type:"string[]"},{internalType:"bool",name:"paused",type:"bool"},{internalType:"string",name:"details",type:"string"},{internalType:"string",name:"tokenURI",type:"string"}],internalType:"struct QuestChainCommons.QuestChainInfo",name:"_info",type:"tuple"}],name:"init",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"limiterContract",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"mintToken",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"pause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"paused",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"premium",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"questChainFactory",outputs:[{internalType:"contract IQuestChainFactory",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"questChainId",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"questChainToken",outputs:[{internalType:"contract IQuestChainToken",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"questCount",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"questDetails",outputs:[{internalType:"bool",name:"paused",type:"bool"},{internalType:"bool",name:"optional",type:"bool"},{internalType:"bool",name:"skipReview",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_quester",type:"address"},{internalType:"uint256",name:"_questId",type:"uint256"}],name:"questStatus",outputs:[{internalType:"enum IQuestChain.Status",name:"status",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"},{internalType:"address",name:"account",type:"address"}],name:"renounceRole",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address[]",name:"_questerList",type:"address[]"},{internalType:"uint256[]",name:"_questIdList",type:"uint256[]"},{internalType:"bool[]",name:"_successList",type:"bool[]"},{internalType:"string[]",name:"_detailsList",type:"string[]"}],name:"reviewProofs",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"_role",type:"bytes32"},{internalType:"address",name:"_account",type:"address"}],name:"revokeRole",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_limiterContract",type:"address"}],name:"setLimiter",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"string",name:"_tokenURI",type:"string"}],name:"setTokenURI",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256[]",name:"_questIdList",type:"uint256[]"},{internalType:"string[]",name:"_proofList",type:"string[]"}],name:"submitProofs",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"interfaceId",type:"bytes4"}],name:"supportsInterface",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"unpause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"upgrade",outputs:[],stateMutability:"nonpayable",type:"function"}];globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,n){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,n),n)}};const M=10,ge=({children:e})=>t.jsxs("div",{role:"alert",className:"alert alert-warning flex items-center mt-10",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 shrink-0 stroke-current",fill:"none",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e]}),xe=()=>{const e=q(),n=Q(),s=R.useRef(null),[a,l]=y.useState(!1),[r,p]=y.useState({}),c=({type:o,error:m})=>{p(f=>({...f,[o]:m}))},{data:i,writeContract:x,isPending:w}=$(),h=B(),u={chain:{type:"chain",error:t.jsxs("h3",{className:"flex text-center items-center justify-center",children:["Please",t.jsx("a",{onClick:()=>{var o;((o=window.ethereum)==null?void 0:o.request).call(o,{method:"wallet_switchEthereumChain",params:[{chainId:`0x${M.toString(16)}`}]})},className:"underline text-accent hover:text-accent-content mx-1",children:"switch to the Optimism network"}),"to continue."]})},account:{type:"account",error:t.jsxs("h3",{className:"flex text-center items-center justify-center",children:["Please",t.jsx("div",{className:"mx-2",children:t.jsx("w3m-button",{size:"sm"})}),"to submit a proof."]})}};y.useEffect(()=>{if(h)return ee(h,{onChange(o){o!==M&&!r.chain&&c(u.chain)}})},[h]);const{contract:d=null}=e&&"contract"in e?e:{};y.useEffect(()=>{i&&v.success(t.jsxs("p",{children:["Successfully submitted transaction",t.jsxs("a",{href:`https://optimistic.etherscan.io/tx/${i}`,className:"mx-1 whitespace-nowrap text-primary hover:text-secondary",target:"_blank",children:[i.substring(0,8),"…",i.slice(-6)]}),"to the Quest Chain contract at",t.jsxs("a",{href:`https://optimistic.etherscan.io/address/${d}`,className:"ml-1 whitespace-nowrap text-primary hover:text-secondary",target:"_blank",children:[d==null?void 0:d.substring(0,6),"…",d==null?void 0:d.slice(-4)]}),"."]}),{duration:12e3,style:{width:"45ch"}})},[i]);const{isLoading:b,isSuccess:C}=D({hash:i});e.reader==null&&!r.account?c(u.account):e.reader!=null&&r.account&&c({type:"account",error:null}),n!==M&&!r.chain?c(u.chain):n===M&&r.chain&&c({type:"chain",error:null});const j=Object.values(r).filter(Boolean);if(j.length>0)return j.map((o,m)=>t.jsx(ge,{children:o},m));const N=R.lazy(()=>Y(()=>import("./MarkdownEditor-ixLsFA0w.js").then(o=>o.w),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),k="Submit Proof",g=b?"Confirming…":w?"Transaction Pending…":a?"Saving to IPFS…":C?"¡Done: Submitted!":k;return t.jsxs(y.Suspense,{fallback:t.jsx("h3",{children:"Loading Submission Editor…"}),children:[t.jsx(N,{editorRef:s,markdown:"",className:"dark-theme dark-editor content mt-10"}),t.jsxs("button",{onClick:async()=>{var m;const o=(m=s.current)==null?void 0:m.getMarkdown();if(!o)throw new Error(`Invalid \`markdown\`: "${o}".`);l(!0);try{const f=new Blob([JSON.stringify({name,description:o})],{type:"application/json"}),L=await H([new File([f],"submission.json")]);if(v.success(t.jsxs("p",{children:["Successfully uploaded your response submission to",t.jsx("a",{href:"https://web3.storage",target:"_blank",className:"mx-1 whitespace-nowrap text-primary hover:text-secondary",children:"Web3.Storage"}),"at",t.jsxs("a",{href:`https://w3s.link/ipfs/${L}`,target:"_blank",className:"ml-1 whitespace-nowrap text-primary hover:text-secondary",children:["ipfs://",L.substring(0,6),"…",L.slice(-4)]}),"."]}),{duration:15e3,position:"bottom-center",style:{width:"45ch"}}),e.on==null)throw new Error("No current chapter.");x({address:d,abi:O,functionName:"submitProofs",args:[[e.on-1],[`ipfs://${L}/submission.json`]]},{onError:I=>{console.error({error:I}),v.error(I.shortMessage??I.message,{duration:12e3})}})}catch(f){console.error({error:f}),v.error(f.message)}finally{l(!1)}},disabled:g!==k,className:"btn btn-wide text-primary my-6",children:[t.jsx("span",{className:T(g.endsWith("…")&&"loading loading-dots loading-md")}),g]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,n){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,n),n)}};function we(){const e=q();return t.jsxs("section",{id:"content",className:"flex-grow",children:[t.jsx("div",{className:"card bg-transparent max-w-prose mt-4 mx-auto",children:t.jsx("div",{className:"content",children:t.jsx(X,{children:e.chapters.active.content})})}),e.on===0?t.jsx("button",{onClick:()=>e.setOn(e.on+1),className:"shadow-md rounded-md bg-secondary p-4 hover:bg-blue-300/60 text-white text-center",children:"Continue"}):["pass"].includes(e.chapters.active.status)?t.jsxs("div",{role:"alert",className:"alert alert-success flex items-center mt-10",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 shrink-0 stroke-current",fill:"none",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),t.jsx("h2",{className:"grow",children:"You have already successfully completed this submission."}),e.on<e.chapters.length-1&&t.jsxs("button",{onClick:()=>e.setOn(e.on+1),className:"btn btn-primary text-fg font-bold self-end",children:["Next ",t.jsx("span",{className:"size-2xl",children:"→"})]})]}):t.jsx(xe,{})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,n){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,n),n)}};const Te=()=>{var h;const e=q(),{data:n,writeContract:s}=$(),{isLoading:a,isSuccess:l}=D({hash:n}),[r,p]=y.useState(!1);if(!e)throw new Error("No book found.");const c=()=>{if(!e)throw new Error("No book found.");s({address:e.contract,abi:O,functionName:"mintToken",args:[]},{onError:u=>{console.error({error:u}),v.error(u.shortMessage??u.message,{duration:12e3})},onSuccess:u=>v.success(t.jsxs("p",{children:["Minted in transaction",t.jsxs("a",{href:`https://optimistic.etherscan.io/tx/${u}`,className:"mx-1 whitespace-nowrap text-primary hover:text-secondary",target:"_blank",children:[u.substring(0,8),"…",u.slice(-6)]}),"."]}),{duration:12e3})})};let i=((h=e.chapters)==null?void 0:h.every(u=>u.status==="pass"||u.optional))&&!e.nft.minted;const x="Mint NFT",w=a?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"loading loading-spinner loading-md"}),"Confirming…"]}):l?"¡Done: Minted!":x;return t.jsx("div",{id:"reward",className:"flex flex-col ml-4 mt-8 md:mt-1",children:t.jsxs("div",{className:"card rounded-sm bg-secondary/25 h-auto max-w-md mr-4 mx-auto",children:[t.jsx("h1",{className:"text-3xl font-bold text-center my-4 mx-2",children:"Completion NFT"}),t.jsx("img",{onLoad:()=>p(!0),src:V(e.nft.image),alt:"Soulbound NFT",className:"w-full h-full object-contain pb-4 px-4"}),!r&&t.jsx("div",{className:"grid place-items-center",children:t.jsx("span",{className:"loading-spinner loading loading-md"})}),i&&t.jsx("button",{disabled:e.nft.minted||w!==x,onClick:c,className:"btn btn-primary",children:w}),e.nft.minted&&t.jsx("h2",{className:"bg-blue-400 rounded-md p-4",children:"You've already collected this NFT."})]})})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,n){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,n),n)}};const ve=()=>{var a;const e=P(),[n,s]=y.useState("Unknown");if(y.useEffect(()=>{e&&"creator"in e&&(s(`${e.creator.substring(0,5)}⋯${e.creator.slice(-3)}`),ue({chain:ce,transport:G()}).getEnsName({address:e.creator}).then(r=>{r&&s(r)}))},[]),e&&e.error)throw e.error;return t.jsxs("header",{children:[t.jsxs("h2",{className:"text-sm text-blue-500 mt-5 text-left pl-1",children:["Creator: ",n]}),t.jsx("h1",{className:"text-4xl md:text-6xl font-bold text-left mt-2",children:e==null?void 0:e.title}),t.jsxs("p",{className:"text-sm text-white text-left pl-1 mt-6 mb-4",children:["Last Updated:"," ",((a=e==null?void 0:e.updatedAt)==null?void 0:a.toLocaleString(void 0,{day:"numeric",month:"long",year:"numeric"}))??"Unknown"]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,n){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,n),n)}};class je extends R.Component{constructor(n){super(n),this.state={error:null}}static getDerivedStateFromError(n){return{error:n.message}}componentDidCatch(n,s){var a,l;console.error({LoggingErrorBoundary:n,info:s}),(l=(a=this.props).onError)==null||l.call(a,n,s)}render(){const{error:n}=this.state;if(n!=null){let{fallback:s}=this.props;return s==null&&(s=t.jsxs("h1",{className:"text-center mt-10",children:["Error: ",n]})),s}return this.props.children}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,n){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,n),n)}};const ke=J("/book/$slug/$chapter/")({component:Ce});function Ce(){try{const{slug:e,chapter:n}=ke.useParams();return t.jsx(je,{children:t.jsx(fe,{chapter:Number(n),slug:e,children:t.jsxs("article",{id:"top",className:"container mx-auto py-20 px-8 lg:px-24 overflow-auto relative",children:[t.jsx(ve,{}),t.jsx("main",{className:"md:flex justify-start overflow-hidden relative",children:t.jsxs(y.Suspense,{fallback:t.jsx("h1",{className:"mt-44",children:"Loading…"}),children:[t.jsx(be,{}),t.jsx(we,{}),t.jsx(Te,{})]})})]})})})}catch(e){return t.jsxs("h1",{children:["Error: ",e.message]})}}export{Ce as Book,ke as Route};
